---
title: "STA457 A3"
author: "Yujia Zheng"
date: "2021/3/16"
output:
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1
## (a)
```{r}
z1 <- c(1, -1.2, 0.85)
polyroot(z1) # find the roots 
```

\newpage

```{r}
# calculate the ACF
h <- 0:10
acf_1 <- -1.0024*((1.0847)^(-h))*cos(0.8622*h+pi-atan(0.0695))
acf_1
# verify the ACF values using the ARMAacf function
ARMAacf(ar=c(1.2, -0.85), ma=0, 10) # AR(2) with phi1 = 1.2, phi2 = -0.85
```

By using the ARMAacf function to verify the ACF values, we can see that the values I calculated are very close to the output of ARMAacf.

## (b)
```{r}
z2 <- c(1, -1, 0.25)
polyroot(z2) # find the roots 
```

By using the ARMAacf function to verify the ACF values, we can see that the values I calculated are very close to the output of ARMAacf.

# Question 2
## (a)
Given ARMA model: $x_t=0.9x_{t-1}+w_t-0.9w_{t-1} \ \text{with} \ w_t$ ~ iid N(0,1)

We have true coefficients: $\phi = 0.9$, $\theta = -0.9$

```{r message=FALSE, warning=FALSE}
# fit the model, plot the simulated data, compute the sample ACF and PACF
library(astsa)
library(tidyverse)
set.seed(299) # set seed to last 3 digits of my student id to get the same result each time
sim_result <- data.frame()
acfpacf <- list(data.frame())
for (i in 1:3){ # repeat the numeric exercise 3 times
  # generate 500 obs from the given ARMA model
  ARMA11 <- arima.sim(list(ar = 0.9, ma = -0.9), n = 500, sd = 1)
  # fit an ARMA(1,1) model to the data
  fit <- arima(ARMA11, order = c(1, 0, 1))
  # record the true parameters and the estimates
  sim_result <- rbind(sim_result, list("Simulation" = i, "true_phi" = 0.9,
                                       "est_phi" = round(fit$coef["ar1"], 4),
                                       "true_theta" = - 0.9,
                                       "est_theta" = round(fit$coef["ma1"], 4),
                                       "true_sd" = 1,
                                       "est_sd" = round(fit$sigma2, 4)))
  plot.ts(ARMA11) # plot the simulated data
  acf2(ARMA11, 30) # sample ACF and PACF
  acfpacf[[i]] <- round(acf2(ARMA11, 10, plot = FALSE), 4) %>%
    as.data.frame() %>%
    mutate(Simulation = i) %>%
    mutate(Lag = row_number()) %>%
    select(Simulation, Lag, ACF, PACF)
}
```

\newpage
## (b) What happened and how to explain the results?

The plots of the simulated data look different each time, but their ACF and PACF have some similarities. According to the plots of ACF and PACF, the values are quite small, with most of the values within the dashed lines (values are slightly larger at some lag, for example, lag = 10 for Sim 3, lag = 20 for Sim 2 and 3).

The table called "sim_result" (shown in part (a)) shows the true parameter values and the parameter estimates for each simulation. We can see that the parameter estimates are different each time. The ARMA11 dataset is simulated with randomness each time, and also the sample size is moderate (maybe not large enough), therefore leads to the difference in parameter estimates in each simulation and the difference with the true parameter.

Here are the first 10 values of ACF and PACF for each simulation:

```{r}
# Show the first 10 values of ACF and PACF for simulation 1
acfpacf[[1]]
# Show the first 10 values of ACF and PACF for simulation 2
acfpacf[[2]]
# Show the first 10 values of ACF and PACF for simulation 3
acfpacf[[3]]
```

\newpage
## (a) Fit an ARMA(1,1) model to the data for each simulation. Plot the parameter estimates in each case with the true values on the same axis.

**The code for fitting the model is in the first chunk of Question 2, and here is a table summarizing the true values and estimated values of each parameter for all 3 simulations:**

```{r}
sim_result
```

### Plot the estimates of phi for 3 simulations with the true value on the same axis:

```{r}
# plot the estimates of phi for 3 simulations with the true value
plot(c(sim_result$true_phi[1], sim_result$est_phi[1],
       sim_result$est_phi[2], sim_result$est_phi[3]), type = "p",
     col = c("red", "blue", "blue", "blue"), ylim = c(0, 1),
     ylab = "Estimated value of phi",
     xlab = "From left to right: true phi, estimated phi for simulation 1, 2, 3",
     main = "True Value vs. Phi Estimates for 3 Simulations")
legend(x = "bottomright", legend = c("true value", "phi estimates"),
       col = c("red", "blue"), lty = c(1,1))
```

\newpage
### Plot the estimates of theta for 3 simulations with the true value on the same axis:
```{r}
# plot the estimates of theta for 3 simulations with the true value
plot(c(sim_result$true_theta[1], sim_result$est_theta[1],
       sim_result$est_theta[2], sim_result$est_theta[3]), type = "p",
     col = c("red", "blue", "blue", "blue"), ylim = c(-1, 0.1),
     ylab = "Estimated value of theta",
     xlab = "From left to right: true theta, estimated theta for simulation 1, 2, 3",
     main = "True Value vs. Theta Estimates for 3 Simulations")
legend(x = "topright", legend = c("true value", "phi estimates"),
       col = c("red", "blue"), lty = c(1,1))
```

\newpage
### Plot the estimates of sigma for 3 simulations with the true value on the same axis:
```{r}
# plot the estimates of sigma for 3 simulations with the true value
plot(c(sim_result$true_sd[1], sim_result$est_sd[1],
       sim_result$est_sd[2], sim_result$est_sd[3]), type = "p",
     col = c("red", "blue", "blue", "blue"), ylim = c(0.85, 1.1),
     ylab = "Estimated value of sigma",
     xlab = "From left to right: true sigma, estimated sigma for simulation 1, 2, 3",
     main = "True Value vs. Sigma Estimates for 3 Simulations")
legend(x = "topleft", legend = c("true value", "phi estimates"),
       col = c("red", "blue"), lty = c(1,1))
```
